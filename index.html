<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ImanPlay</title>

<link href="https://fonts.googleapis.com/css2?family=Amiri&family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">

<style>

*{box-sizing:border-box}

body{
margin:0;
font-family:Poppins;
background:#081629;
color:white;
overflow-x:hidden;
}

header{
text-align:center;
padding:25px;
font-size:30px;
font-family:Amiri;
background:#0c2a55;
}

.panel{
max-width:420px;
margin:40px auto;
background:#0f2140;
padding:25px;
border-radius:20px;
box-shadow:0 0 30px rgba(0,0,0,.6);
}

.row{
display:flex;
justify-content:space-between;
padding:10px 0;
font-size:18px;
border-bottom:1px solid #1c3a70;
}

/* SIDE NOTIFICATION ANIMATION */

@keyframes slideSide{
from{right:-350px}
to{right:20px}
}

.sideNotify{
position:fixed;
top:30px;
right:-350px;
width:300px;
background:#133b78;
padding:20px;
border-radius:15px;
box-shadow:0 0 25px black;
animation:slideSide 1s forwards;
z-index:999;
}

/* FULL SCREEN BLOCK */

#overlay{
position:fixed;
top:0;
left:0;
right:0;
bottom:0;
background:#081629;
display:none;
align-items:center;
justify-content:center;
flex-direction:column;
z-index:9999;
animation:zoomIn .7s ease;
}

@keyframes zoomIn{
from{transform:scale(.7);opacity:0}
to{transform:scale(1);opacity:1}
}

#overlay h1{
font-family:Amiri;
font-size:60px;
margin:0;
}

#overlay p{
font-size:20px;
opacity:.8;
}

#countdown{
font-size:45px;
margin-top:25px;
color:#00ffcc;
}

/* Prevent interaction */
.lock{
pointer-events:none;
}

</style>
</head>

<body>

<header>ImanPlay</header>

<div class="panel">

<div class="row"><span>Fajr</span><span id="fajr">--</span></div>
<div class="row"><span>Dhuhr</span><span id="dhuhr">--</span></div>
<div class="row"><span>Asr</span><span id="asr">--</span></div>
<div class="row"><span>Maghrib</span><span id="maghrib">--</span></div>
<div class="row"><span>Isha</span><span id="isha">--</span></div>

</div>

<div id="overlay">
<h1>ðŸ•Œ Time To Pray</h1>
<p>Screen locked for worship</p>
<div id="countdown"></div>
</div>

<audio id="sound" src="https://actions.google.com/sounds/v1/alarms/digital_watch_alarm_long.ogg"></audio>

<script>

const overlay=document.getElementById("overlay");
const sound=document.getElementById("sound");
let locked=false;

/* BLOCK CLOSE */
window.addEventListener("beforeunload",e=>{
if(locked){
e.preventDefault();
e.returnValue="";
}
});

/* GEO */

navigator.geolocation.getCurrentPosition(pos=>{
loadTimes(pos.coords.latitude,pos.coords.longitude);
},()=>loadTimes(43.4675,-79.6877));

function loadTimes(lat,lon){

fetch(`https://api.aladhan.com/v1/timings?latitude=${lat}&longitude=${lon}&method=2`)
.then(r=>r.json())
.then(d=>{

const t=d.data.timings;

fajr.innerHTML=t.Fajr;
dhuhr.innerHTML=t.Dhuhr;
asr.innerHTML=t.Asr;
maghrib.innerHTML=t.Maghrib;
isha.innerHTML=t.Isha;

schedule(t);

});
}

/* NOTIFICATION PERMISSION */
if(Notification.permission!=="granted") Notification.requestPermission();

/* SIDE POP */

function side(msg){

if(Notification.permission==="granted"){
new Notification(msg,{body:"Get ready for salah",icon:"https://cdn-icons-png.flaticon.com/512/616/616408.png"});
}

const div=document.createElement("div");
div.className="sideNotify";
div.innerHTML=`<b>${msg}</b><br>5 minutes left`;
document.body.appendChild(div);

sound.play();

setTimeout(()=>div.remove(),15000);
}

/* FULL BLOCK */

function block(){

locked=true;
overlay.style.display="flex";
document.body.classList.add("lock");

sound.play();

let seconds=420;

const timer=setInterval(()=>{

let m=Math.floor(seconds/60);
let s=seconds%60;

countdown.innerHTML=`${m}:${s.toString().padStart(2,"0")}`;

seconds--;

if(seconds<0){
clearInterval(timer);
overlay.style.display="none";
document.body.classList.remove("lock");
locked=false;
}

},1000);

}

/* SCHEDULER */

function schedule(times){

["Fajr","Dhuhr","Asr","Maghrib","Isha"].forEach(p=>{

const [h,m]=times[p].split(":");
const now=new Date();
const pray=new Date();

pray.setHours(h,m,0,0);

const sideTime=new Date(pray.getTime()-300000);

const sDelay=sideTime-now;
const bDelay=pray-now;

if(sDelay>0) setTimeout(()=>side(p+" in 5 minutes"),sDelay);
if(bDelay>0) setTimeout(block,bDelay);

});
}

</script>

</body>
</html>
